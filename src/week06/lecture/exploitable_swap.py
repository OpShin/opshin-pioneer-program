from opshin.prelude import *


@dataclass()
class DatumSwap(PlutusData):
    beneficiary: PubKeyHash
    price: int


def validator(datum: DatumSwap, redeemer: None, context: ScriptContext):
    tx_info = context.tx_info
    payed = False
    for output in tx_info.outputs:
        payment_cred: PubKeyCredential = output.address.payment_credential
        sent_datum: SomeOutputDatum = output.datum
        d: DatumSwap = sent_datum.datum
        if (payment_cred.credential_hash == datum.beneficiary) and (d == datum):
            value_paid = output.value
            ada_payed = value_paid.get(b"", {b"": 0}).get(b"", 0)
            if ada_payed == datum.price:
                payed = True
    assert payed, "Hey! You have to pay the owner!"
